#= require jquery
#= require jquery_ujs
#= require jquery-fileupload/basic
#= require jquery.caret
#= require form_storage
#= require bootstrap/dropdown
#= require bootstrap/collapse
#= require bootstrap/alert
#= require bootstrap/tab
#= require jquery.checkall
#= require qrcode
#= require jquery.ba-throttle-debounce
#= require jquery.fluidbox.min
#= require jquery.lazyload
#= require rails-timeago
#= require locales/jquery.timeago.zh-CN.js
#= require bootstrap-markdown-bundle
#= require locale/bootstrap-markdown.zh
#= require toastr.min
#= require social-share-button
#= require social-share-button/wechat
#= require sweetalert
#= require devise
#= require jquery.infinite-pages

jQuery ->
  $("img.lazy").lazyload()

$ ->
  socket = new WebSocket "<%= Settings.ws_protocol %>://#{window.location.host}/ws/"

  socket.onmessage = (event) ->
    # toastr.options.closeDuration = 40000
    # toastr.remove()
    # if event.data.length
    #   toastr.success("#{event.data}", '有消息啦！')
    json_data = JSON.parse(event.data)
    if event.data.length
      new Notification json_data["title"],
        # body: "#{event.data}"
        body: json_data["content"]
        icon: "https://www.rails365.net/favicon.ico"

Notification.requestPermission()

jQuery ->
  flash = [
    "info"
    "success"
    "danger"
    "warning"
  ]
  for key of flash
    select = ".alert-autocloseable-" + flash[key]
    $(select).delay(5000).fadeOut()  if $(select).length > 0

jQuery ->
  $('.pagination').infinitePages
    debug: true
    loading: ->
      # jQuery callback on the nav element
      $(".pagination-text").text("正在加载下一页...")
    success: ->
      # called after successful ajax call
    error: ->
      # called after failed ajax call
      $(".pagination-text").text("Trouble! Please drink some coconut water and click again")
